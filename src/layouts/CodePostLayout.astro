---
// src/layouts/CodePostLayout.astro
import { Image } from "astro:assets";
import codeLogo from "../assets/images/codesg/logo.jpeg";
import SEO from "../components/shared/SEO.astro";

// Simulamos datos (Frontmatter)
const { frontmatter } = Astro.props;

// Extracci√≥n de datos con seguridad
const title = frontmatter?.title || "Proyecto CODE.SG";
const description = frontmatter?.description || "Proyecto Maker de CODE.SG.";
const image = frontmatter?.image;

// Valores por defecto para evitar errores
const status = frontmatter?.status || "En Progreso"; // Estados: Terminado, Beta, Idea
const tags = frontmatter?.tags || ["Maker", "DIY"];
const pubDate = frontmatter?.pubDate
    ? new Date(frontmatter.pubDate).toLocaleDateString()
    : "Hoy";

// Aseguramos que resources sea un array (por si es undefined)
const resources = frontmatter.resources || [];
---

<html lang="es">
    <head>
        <SEO
            title={title}
            description={description}
            image={image}
            article={true}
        />
    </head>
    <body
        class="bg-brand-cream text-att-black font-sans antialiased selection:bg-code-green selection:text-white"
    >
        <div
            class="fixed inset-0 opacity-10 pointer-events-none z-0"
            style="background-image: radial-gradient(#264653 2px, transparent 2px); background-size: 24px 24px;"
        >
        </div>

        <nav
            class="relative z-50 border-b-4 border-black bg-code-green py-4 px-6"
        >
            <div class="max-w-6xl mx-auto flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div
                        class="bg-white border-2 border-black h-12 w-12 flex items-center justify-center shadow-retro shrink-0 overflow-hidden"
                    >
                        <Image
                            src={codeLogo}
                            alt="CODE.SG Logo"
                            class="w-full h-auto object-contain"
                            loading="eager"
                        />
                    </div>
                    <span
                        class="font-display text-2xl text-white drop-shadow-md tracking-wide"
                        >CODE.SG</span
                    >
                </div>
                <a
                    href="/"
                    class="bg-white px-4 py-2 border-2 border-black font-display text-sm hover:shadow-retro transition-all hover:-translate-y-1 hover:bg-brand-red hover:text-white"
                >
                    SALIR DEL TALLER
                </a>
            </div>
        </nav>

        <main class="relative z-10 max-w-5xl mx-auto p-6 md:p-12">
            <header class="mb-12 text-center md:text-left relative">
                <div
                    class="absolute -top-6 right-0 md:right-10 transform rotate-6 animate-pulse"
                >
                    <span
                        class={`
                    px-6 py-2 border-2 border-black font-display text-lg uppercase shadow-retro text-white
                    ${status === "Terminado" ? "bg-code-green" : "bg-brand-red"}
                `}
                    >
                        {status}
                    </span>
                </div>

                <div
                    class="flex flex-wrap gap-2 mb-4 justify-center md:justify-start"
                >
                    {
                        tags.map((tag: string) => (
                            <span class="bg-brand-cream border border-black px-2 py-1 text-xs font-bold font-mono uppercase">
                                #{tag}
                            </span>
                        ))
                    }
                </div>

                <h1
                    class="font-display text-5xl md:text-7xl text-code-dark mb-4 drop-shadow-sm leading-none"
                >
                    {title}
                </h1>

                <p
                    class="font-mono text-sm text-gray-500 bg-white inline-block px-2 border border-black"
                >
                    Log de fecha: {pubDate}
                </p>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-12 gap-8">
                <article class="md:col-span-8">
                    <div
                        class="bg-white border-4 border-black p-8 shadow-retro
                    prose prose-lg max-w-none
                    prose-headings:font-display prose-headings:text-code-dark
                    prose-a:text-code-green prose-a:font-black prose-a:decoration-4 prose-a:underline-offset-2
                    prose-blockquote:border-l-8 prose-blockquote:border-code-green prose-blockquote:bg-gray-100 prose-blockquote:p-4 prose-blockquote:not-italic prose-blockquote:font-display
                    prose-img:border-2 prose-img:border-black prose-img:shadow-retro prose-img:rotate-1 hover:prose-img:rotate-0 prose-img:transition-transform
                    prose-pre:border-2 prose-pre:border-black prose-pre:bg-[#2d2d2d] prose-pre:rounded-none"
                    >
                        <slot />
                    </div>
                </article>

                <aside class="md:col-span-4 space-y-6">
                    <div
                        class="bg-[#FFF9C4] border-2 border-black p-6 shadow-retro transform -rotate-1"
                    >
                        <h3
                            class="font-display text-xl mb-4 border-b-2 border-black pb-1"
                        >
                            üì¶ Materiales
                        </h3>
                        <ul
                            class="list-disc list-inside space-y-2 font-mono text-sm"
                        >
                            <li>Arduino Nano / ESP32</li>
                            <li>Filamento PLA+</li>
                            <li>Tornillos M3 x 10mm</li>
                            <li>Caf√© (Mucho caf√©)</li>
                        </ul>
                    </div>

                    {
                        resources.length > 0 && (
                            <div class="bg-white border-2 border-black p-6 shadow-retro">
                                <h3 class="font-display text-xl mb-4 flex items-center gap-2">
                                    üíæ Descargas
                                </h3>
                                <div class="space-y-3">
                                    {resources.map((res: any) => (
                                        <a
                                            href={res.url}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            class={`
                                            group flex items-center justify-center gap-3 w-full py-3 border-2 border-black font-display text-sm transition-all
                                            ${res.type === "github" ? "bg-[#24292e] text-white hover:bg-black" : ""}
                                            ${res.type === "download" ? "bg-code-green text-white hover:bg-code-dark" : ""}
                                            ${res.type === "video" ? "bg-brand-red text-white hover:bg-red-700" : ""}
                                            ${res.type === "doc" ? "bg-white text-black hover:bg-gray-100" : ""}
                                            hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:-translate-y-1
                                        `}
                                        >
                                            {res.type === "github" && (
                                                <span>üò∫</span>
                                            )}
                                            {res.type === "download" && (
                                                <span>‚¨áÔ∏è</span>
                                            )}
                                            {res.type === "video" && (
                                                <span>üì∫</span>
                                            )}
                                            {res.type === "doc" && (
                                                <span>üìÑ</span>
                                            )}

                                            <span>{res.label}</span>
                                        </a>
                                    ))}
                                </div>
                            </div>
                        )
                    }
                </aside>
            </div>
        </main>

        <footer
            class="mt-20 py-8 bg-black text-white text-center font-mono text-xs"
        >
            // CODE.SG_SYSTEMS // BUILD_VER_2.0 // EOF
        </footer>
    </body>
</html>
