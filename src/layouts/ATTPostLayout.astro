---
// src/layouts/ATTPostLayout.astro
import BaseLayout from "./BaseLayout.astro"; // Tu layout base HTML
import { Image } from "astro:assets";
import attLogo from "../assets/images/att/logo.png";
import SEO from "../components/shared/SEO.astro";
import SpeedInsights from "@vercel/speed-insights/astro";

// Simulamos datos que vendrían del Markdown (Frontmatter)
const { frontmatter, headings = [] } = Astro.props;

// Extracción de datos con seguridad
const title = frontmatter?.title || "Artículo ATT";
const description =
    frontmatter?.description || "Recurso educativo de la Academia Tecnológica.";
const image = frontmatter?.image;

const category = frontmatter?.category || "Fundamentos de Programación";
const author = "Ing. PauMag";
const date = frontmatter?.pubDate
    ? new Date(frontmatter.pubDate).toLocaleDateString()
    : "12 OCT 2025";

// Aseguramos que resources sea un array
const resources = frontmatter?.resources || [];
---

<html lang="es">
    <head>
        <SEO
            title={title}
            description={description}
            image={image}
            article={true}
        />
    </head>
    <body class="bg-brand-cream text-att-black font-sans antialiased">
        <nav
            class="border-b-4 border-att-black bg-white py-4 px-6 flex justify-between items-center sticky top-0 z-50"
        >
            <div class="flex items-center gap-2">
                <div
                    class="w-12 h-12 flex items-center justify-center shrink-0"
                >
                    <Image
                        loading="eager"
                        src={attLogo}
                        alt="ATT Logo"
                        class="w-full h-full object-contain mix-blend-multiply"
                    />
                </div>
                <span class="font-bold tracking-tighter text-xl"
                    >ATT <span class="text-brand-red">ACADEMIA TECNOLOGICA</span
                    ></span
                >
            </div>
            <a
                href="/"
                class="text-sm font-bold uppercase hover:text-brand-red hover:underline decoration-2 underline-offset-4"
            >
                &larr; Volver al Hub
            </a>
        </nav>

        <main
            class="max-w-screen-xl mx-auto flex flex-col md:flex-row gap-12 p-6 md:p-12"
        >
            <article class="flex-1 min-w-0">
                <header class="mb-10 pb-8 border-b border-att-gray/30">
                    <div
                        class="flex items-center gap-3 mb-4 text-xs font-bold tracking-widest uppercase text-brand-red"
                    >
                        <span class="border border-brand-red px-2 py-1"
                            >{category}</span
                        >
                        <span>•</span>
                        <span>{date}</span>
                    </div>

                    <h1
                        class="text-4xl md:text-5xl font-extrabold tracking-tight mb-6 leading-tight text-att-black"
                    >
                        {title}
                    </h1>

                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 bg-att-black rounded-full text-white flex items-center justify-center font-bold"
                        >
                            PM
                        </div>
                        <div>
                            <p class="text-sm font-bold text-att-black">
                                {author}
                            </p>
                            <p class="text-xs text-att-gray">
                                Director Académico
                            </p>
                        </div>
                    </div>
                </header>

                <div
                    class="prose prose-lg max-w-none
                prose-headings:font-bold prose-headings:tracking-tight prose-headings:text-att-black
                prose-p:text-att-gray prose-p:leading-relaxed
                prose-a:text-brand-red prose-a:font-bold prose-a:no-underline hover:prose-a:underline
                prose-strong:text-att-black
                prose-code:text-brand-red prose-code:bg-white prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:border prose-code:border-gray-200
                prose-pre:bg-[#1e1e1e] prose-pre:shadow-tech prose-pre:border prose-pre:border-gray-800
                prose-img:rounded-sm prose-img:border prose-img:border-att-black"
                >
                    <slot />
                </div>
            </article>

            <aside class="w-full md:w-64 lg:w-80 space-y-8 hidden md:block">
                {
                    headings.length > 0 && (
                        <div class="sticky top-24 p-6 bg-white border border-gray-200 shadow-tech">
                            <h3 class="font-bold text-sm uppercase tracking-widest mb-4 text-att-black border-b border-brand-red pb-2">
                                En este artículo
                            </h3>
                            <ul class="space-y-3 text-sm text-att-gray">
                                {headings.map((heading: any) => (
                                    <li>
                                        <a
                                            href={`#${heading.slug}`}
                                            class={`hover:text-brand-red hover:translate-x-1 transition-transform block ${heading.depth > 2 ? "pl-4" : ""}`}
                                        >
                                            {heading.text}
                                        </a>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    )
                }

                {
                    resources.length > 0 && (
                        <div class="p-6 bg-att-black text-white">
                            <h3 class="font-bold text-lg mb-2">Recursos ATT</h3>
                            <p class="text-sm text-gray-400 mb-4">
                                Material complementario de esta lección.
                            </p>
                            <div class="space-y-2">
                                {resources.map((res: any) => (
                                    <a
                                        href={res.url}
                                        target="_blank"
                                        class="block w-full py-2 bg-brand-red text-center text-white font-bold uppercase text-xs hover:bg-white hover:text-brand-red transition-colors"
                                    >
                                        {res.label || "Descargar"}
                                    </a>
                                ))}
                            </div>
                        </div>
                    )
                }
            </aside>
        </main>

        <footer
            class="border-t border-gray-300 py-12 text-center text-att-gray text-sm"
        >
            <p>
                &copy; 2024 Academia Tecnológica de Toluca (v2.0 Deployment
                Check).
            </p>
        </footer>
        <SpeedInsights />
    </body>
</html>
